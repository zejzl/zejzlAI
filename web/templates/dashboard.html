<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZEJZL.NET Dashboard - AI Orchestration Control Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 px-6 py-4">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                    <span class="text-xl font-bold">Z</span>
                </div>
                <div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent">
                        ZEJZL.NET
                    </h1>
                    <p class="text-sm text-gray-400">AI Orchestration Control Center</p>
                </div>
            </div>
             <div class="flex items-center space-x-4">
                 <div class="flex items-center space-x-2">
                     <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                     <span class="text-sm text-green-400">System Online</span>
                 </div>
                 <!-- WebSocket Status Indicator -->
                 <div class="flex items-center space-x-2 text-sm">
                     <div class="w-3 h-3 rounded-full bg-gray-500" id="ws-status-dot"></div>
                     <span id="ws-status-text" class="text-gray-400">Connecting...</span>
                 </div>

                 <!-- Offline Mode Toggle -->
                 <div class="flex items-center space-x-2">
                     <span class="text-sm text-gray-400">Offline:</span>
                     <button id="offline-toggle" class="relative inline-flex h-6 w-11 items-center rounded-full bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                         <span id="offline-toggle-dot" class="inline-block h-4 w-4 transform rounded-full bg-white transition-transform translate-x-1"></span>
                     </button>
                     <span id="offline-status" class="text-sm text-gray-400">OFF</span>
                 </div>
                 <button id="theme-toggle" class="p-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors">
                     <i data-lucide="moon" class="w-5 h-5"></i>
                 </button>
                 <div class="text-sm text-gray-400" id="current-timestamp">--:--:--</div>
             </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-gray-800 px-6 py-2 border-b border-gray-700">
        <div class="flex items-center justify-between">
            <div class="flex space-x-6">
            <button class="nav-tab active px-4 py-2 rounded-lg bg-blue-600 text-white" data-tab="overview">
                <i data-lucide="home" class="w-4 h-4 inline mr-2"></i>Overview
            </button>
            <button class="nav-tab px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors" data-tab="analytics">
                <i data-lucide="bar-chart-3" class="w-4 h-4 inline mr-2"></i>Analytics
            </button>
            <button class="nav-tab px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors" data-tab="multimodal">
                <i data-lucide="image" class="w-4 h-4 inline mr-2"></i>Multi-Modal
            </button>
            <button class="nav-tab px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors" data-tab="chat">
                <i data-lucide="message-circle" class="w-4 h-4 inline mr-2"></i>AI Chat
            </button>
            <button class="nav-tab px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors" data-tab="monitoring">
                <i data-lucide="activity" class="w-4 h-4 inline mr-2"></i>Monitoring
            </button>
            <button class="nav-tab px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors" data-tab="security">
                <i data-lucide="shield" class="w-4 h-4 inline mr-2"></i>Security
            </button>
             <button class="nav-tab px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors" data-tab="mcp">
                <i data-lucide="server" class="w-4 h-4 inline mr-2"></i>MCP
            </button>
            <button class="nav-tab px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors" data-tab="vault">
                <i data-lucide="package" class="w-4 h-4 inline mr-2"></i>Community Vault
            </button>
            </div>

            <!-- Global Search -->
            <div class="flex items-center space-x-2">
                <div class="relative">
                    <i data-lucide="search" class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="global-search" placeholder="Search dashboard..." class="pl-10 pr-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="px-6 py-6">

        <!-- Overview Tab -->
        <div id="overview-tab" class="tab-content">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- System Status Cards -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-400">Total Requests</p>
                            <p class="text-2xl font-bold text-blue-400" id="total-requests">-</p>
                        </div>
                        <i data-lucide="zap" class="w-8 h-8 text-blue-400"></i>
                    </div>
                </div>

                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-400">Tokens Used</p>
                            <p class="text-2xl font-bold text-green-400" id="total-tokens">-</p>
                        </div>
                        <i data-lucide="cpu" class="w-8 h-8 text-green-400"></i>
                    </div>
                </div>

                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-400">Total Cost</p>
                            <p class="text-2xl font-bold text-yellow-400" id="total-cost">-$0.00</p>
                        </div>
                        <i data-lucide="dollar-sign" class="w-8 h-8 text-yellow-400"></i>
                    </div>
                </div>

                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-400">Success Rate</p>
                            <p class="text-2xl font-bold text-purple-400" id="success-rate">-%</p>
                        </div>
                        <i data-lucide="trending-up" class="w-8 h-8 text-purple-400"></i>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
             <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                 <h3 class="text-lg font-semibold mb-4 flex items-center">
                     <i data-lucide="clock" class="w-5 h-5 mr-2"></i>Recent Activity
                 </h3>
                 <div id="recent-activity" class="space-y-3">
                     <div class="animate-pulse flex space-x-4">
                         <div class="rounded-full bg-gray-700 h-8 w-8"></div>
                         <div class="flex-1 space-y-2">
                             <div class="h-4 bg-gray-700 rounded w-3/4"></div>
                             <div class="h-4 bg-gray-700 rounded w-1/2"></div>
                         </div>
                     </div>
                 </div>
             </div>

             <!-- Cache Status -->
             <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                 <h3 class="text-lg font-semibold mb-4 flex items-center">
                     <i data-lucide="database" class="w-5 h-5 mr-2"></i>Cache Status
                 </h3>
                 <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                     <div class="text-center">
                         <p class="text-sm text-gray-400">Cached Responses</p>
                         <p class="text-2xl font-bold text-blue-400" id="cache-entries">-</p>
                     </div>
                     <div class="text-center">
                         <p class="text-sm text-gray-400">Cache Size</p>
                         <p class="text-2xl font-bold text-green-400" id="cache-size">-</p>
                     </div>
                     <div class="text-center">
                         <p class="text-sm text-gray-400">Usage</p>
                         <p class="text-2xl font-bold text-yellow-400" id="cache-usage">-</p>
                     </div>
                     <div class="text-center">
                         <p class="text-sm text-gray-400">Connectivity</p>
                         <p class="text-xs font-medium px-2 py-1 rounded" id="connectivity-indicator">UNKNOWN</p>
                     </div>
                 </div>
                 <div class="mt-4 flex space-x-2">
                     <button id="clear-cache-btn" class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-sm transition-colors">
                         Clear Cache
                     </button>
                     <button id="refresh-cache-btn" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm transition-colors">
                         Refresh Stats
                     </button>
                 </div>
             </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Usage Chart -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold mb-4">Usage Analytics</h3>
                    <canvas id="usageChart" width="400" height="200"></canvas>
                </div>

                <!-- Cost Analysis -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold mb-4">Cost Analysis</h3>
                    <canvas id="costChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Provider Performance -->
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h3 class="text-lg font-semibold mb-4">Provider Performance</h3>
                <div id="provider-performance" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Provider cards will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Multi-Modal Tab -->
        <div id="multimodal-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- File Upload -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i data-lucide="upload" class="w-5 h-5 mr-2"></i>File Upload
                    </h3>

                    <div class="space-y-4">
                        <div id="file-drop-zone" class="border-2 border-dashed border-gray-600 rounded-lg p-8 text-center hover:border-blue-500 transition-colors cursor-pointer">
                            <input type="file" id="file-input" accept=".pdf,.jpg,.jpeg,.png,.gif,.webp,.txt,.md,.mp3,.wav,.mp4,.avi,.mov" class="hidden">
                            <label for="file-input" class="cursor-pointer block h-full">
                                <i data-lucide="upload-cloud" class="w-12 h-12 mx-auto mb-4 text-gray-400"></i>
                                <p class="text-gray-400 mb-2">Click to upload or drag and drop</p>
                                <p class="text-sm text-gray-500">Images, Videos, Audio, Documents, PDFs (max 50MB)</p>
                                <p class="text-xs text-gray-600 mt-1">Supports multi-modal AI processing</p>
                            </label>
                        </div>

                        <div id="file-preview" class="hidden bg-gray-700 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i data-lucide="file" class="w-8 h-8 text-blue-400"></i>
                                    <div>
                                        <p class="font-medium" id="file-name"></p>
                                        <p class="text-sm text-gray-400" id="file-size"></p>
                                    </div>
                                </div>
                                <button id="remove-file" class="text-red-400 hover:text-red-300">
                                    <i data-lucide="x" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analysis Options -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold mb-4">Analysis Options</h3>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Analysis Type</label>
                            <select id="analysis-type" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2">
                                <option value="auto">Auto Detect</option>
                                <option value="pdf-text">Extract PDF Text</option>
                                <option value="image-describe">Describe Image</option>
                                <option value="document-analyze">Analyze Document</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2">AI Provider</label>
                            <select id="ai-provider" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2">
                                <option value="gpt4vision">GPT-4 Vision</option>
                                <option value="gemini-vision">Gemini Vision</option>
                                <option value="grok">Grok</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2">Custom Query (optional)</label>
                            <textarea id="custom-query" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 h-20 resize-none"
                                placeholder="Ask a specific question about the file..."></textarea>
                        </div>

                        <button id="analyze-btn" class="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed px-4 py-2 rounded-lg transition-colors flex items-center justify-center">
                            <i data-lucide="search" class="w-4 h-4 mr-2"></i>
                            <span id="analyze-text">Analyze File</span>
                        </button>
                    </div>
                </div>
            </div>

             <!-- Analysis Results -->
             <div id="analysis-results" class="mt-6 bg-gray-800 rounded-lg p-6 border border-gray-700 hidden">
                 <h3 class="text-lg font-semibold mb-4 flex items-center">
                     <i data-lucide="file-text" class="w-5 h-5 mr-2"></i>Analysis Results
                 </h3>
                 <div id="results-content" class="prose prose-invert max-w-none">
                     <!-- Results will be populated here -->
                 </div>
             </div>

             <!-- Processing History -->
             <div class="mt-6">
                 <h3 class="text-lg font-semibold mb-4 flex items-center">
                     <i data-lucide="history" class="w-5 h-5 mr-2"></i>Processing History
                 </h3>
                 <div id="multimodal-history" class="bg-gray-800 rounded-lg p-4 border border-gray-700 max-h-96 overflow-y-auto">
                     <p class="text-gray-400 text-center py-8">No processing history yet</p>
                 </div>
             </div>
         </div>

        <!-- Chat Tab -->
        <div id="chat-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]">
                <!-- Chat Interface -->
                <div class="lg:col-span-2 bg-gray-800 rounded-lg border border-gray-700 flex flex-col">
                    <div class="p-4 border-b border-gray-700">
                        <h3 class="text-lg font-semibold flex items-center">
                            <i data-lucide="message-circle" class="w-5 h-5 mr-2"></i>AI Chat
                        </h3>
                    </div>

                    <!-- Messages -->
                    <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4">
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                                <i data-lucide="bot" class="w-4 h-4"></i>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-3 max-w-xs lg:max-w-md">
                                <p class="text-sm">Hello! I'm your AI assistant. How can I help you today?</p>
                            </div>
                        </div>
                    </div>

                    <!-- Input -->
                    <div class="p-4 border-t border-gray-700">
                        <!-- File Attachment Preview -->
                        <div id="chat-attachment-preview" class="hidden mb-3 p-3 bg-gray-700 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <i data-lucide="paperclip" class="w-4 h-4 text-blue-400"></i>
                                    <div>
                                        <p class="text-sm font-medium" id="attachment-name"></p>
                                        <p class="text-xs text-gray-400" id="attachment-size"></p>
                                    </div>
                                </div>
                                <button id="remove-attachment" class="text-red-400 hover:text-red-300">
                                    <i data-lucide="x" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>

                        <div class="flex space-x-2">
                            <input type="file" id="chat-file-input" accept=".jpg,.jpeg,.png,.gif,.webp,.pdf,.txt,.md" class="hidden">
                            <button id="attach-file-btn" class="bg-gray-700 hover:bg-gray-600 p-2 rounded-lg transition-colors" title="Attach file">
                                <i data-lucide="paperclip" class="w-4 h-4"></i>
                            </button>
                            <input type="text" id="chat-input" placeholder="Type your message or attach a file..."
                                class="flex-1 bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button id="send-chat-btn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                                <i data-lucide="send" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Chat Settings -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold mb-4">Chat Settings</h3>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">AI Provider</label>
                            <select id="chat-provider" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2">
                                <option value="grok">Grok</option>
                                <option value="chatgpt">ChatGPT</option>
                                <option value="claude">Claude</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium mb-2">Mode</label>
                            <select id="chat-mode" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2">
                                <option value="text">Text Only</option>
                                <option value="multimodal">Multi-Modal</option>
                            </select>
                        </div>

                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="streaming" class="rounded">
                            <label for="streaming" class="text-sm">Enable streaming</label>
                        </div>

                        <div class="flex items-center space-x-2">
                            <input type="checkbox" id="rlm-mode" class="rounded">
                            <label for="rlm-mode" class="text-sm">RLM Mode (Pantheon Multi-Agent)</label>
                        </div>

                        <button id="clear-chat" class="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors">
                            <i data-lucide="trash-2" class="w-4 h-4 mr-2"></i>Clear Chat
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Monitoring Tab -->
        <div id="monitoring-tab" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- System Health -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i data-lucide="heart" class="w-5 h-5 mr-2"></i>System Health
                    </h3>
                    <div id="system-health" class="space-y-4">
                        <!-- Health metrics will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Active Processes -->
                <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i data-lucide="activity" class="w-5 h-5 mr-2"></i>Active Processes
                    </h3>
                    <div id="active-processes" class="space-y-3">
                        <!-- Process list will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Logs -->
            <div class="mt-6 bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i data-lucide="file-text" class="w-5 h-5 mr-2"></i>System Logs
                </h3>
                <div id="system-logs" class="bg-black rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm">
                    <!-- Logs will be populated by JavaScript -->
                </div>
            </div>
         </div>

         <!-- Security Tab -->
         <div id="security-tab" class="tab-content hidden">
             <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                 <!-- Security Overview -->
                 <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                     <h3 class="text-lg font-semibold mb-4 flex items-center">
                         <i data-lucide="shield" class="w-5 h-5 mr-2"></i>Security Overview
                     </h3>
                     <div class="space-y-4">
                         <div class="flex justify-between items-center">
                             <span class="text-sm text-gray-400">Total Validations</span>
                             <span class="text-lg font-semibold text-blue-400" id="total-validations">-</span>
                         </div>
                         <div class="flex justify-between items-center">
                             <span class="text-sm text-gray-400">Pending Approvals</span>
                             <span class="text-lg font-semibold text-yellow-400" id="pending-approvals">-</span>
                         </div>
                         <div class="flex justify-between items-center">
                             <span class="text-sm text-gray-400">Blocked Operations</span>
                             <span class="text-lg font-semibold text-red-400" id="blocked-operations">-</span>
                         </div>
                     </div>
                 </div>

                 <!-- Risk Distribution -->
                 <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                     <h3 class="text-lg font-semibold mb-4 flex items-center">
                         <i data-lucide="alert-triangle" class="w-5 h-5 mr-2"></i>Risk Distribution
                     </h3>
                     <canvas id="risk-chart" width="200" height="200"></canvas>
                 </div>

                 <!-- Security Actions -->
                 <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                     <h3 class="text-lg font-semibold mb-4 flex items-center">
                         <i data-lucide="settings" class="w-5 h-5 mr-2"></i>Security Actions
                     </h3>
                     <div class="space-y-3">
                         <button class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors" onclick="refreshSecurityData()">
                             <i data-lucide="refresh-cw" class="w-4 h-4 inline mr-2"></i>Refresh Data
                         </button>
                         <button class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors" onclick="exportSecurityReport()">
                             <i data-lucide="download" class="w-4 h-4 inline mr-2"></i>Export Report
                         </button>
                         <button class="w-full bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg transition-colors" onclick="configureSecurityPolicies()">
                             <i data-lucide="settings" class="w-4 h-4 inline mr-2"></i>Configure Policies
                         </button>
                     </div>
                 </div>
             </div>

             <!-- Pending Approvals -->
             <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6">
                 <h3 class="text-lg font-semibold mb-4 flex items-center">
                     <i data-lucide="clock" class="w-5 h-5 mr-2"></i>Pending Approvals
                 </h3>
                 <div id="pending-approvals-list" class="space-y-4">
                     <!-- Pending approvals will be populated by JavaScript -->
                     <div class="text-center text-gray-400 py-8">
                         <i data-lucide="check-circle" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
                         <p>No pending approvals</p>
                     </div>
                 </div>
             </div>

             <!-- Security Log -->
             <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                 <h3 class="text-lg font-semibold mb-4 flex items-center">
                     <i data-lucide="file-text" class="w-5 h-5 mr-2"></i>Security Log
                 </h3>
                 <div id="security-log" class="bg-black rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm">
                     <!-- Security events will be populated by JavaScript -->
                 </div>
             </div>
          </div>

          <!-- MCP Tab -->
          <div id="mcp-tab" class="tab-content hidden">
              <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                  <!-- MCP Overview -->
                  <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                      <h3 class="text-lg font-semibold mb-4 flex items-center">
                          <i data-lucide="server" class="w-5 h-5 mr-2"></i>MCP Overview
                      </h3>
                      <div class="space-y-4">
                          <div class="flex justify-between items-center">
                              <span class="text-sm text-gray-400">Active Servers</span>
                              <span class="text-lg font-semibold text-green-400" id="mcp-active-servers">-</span>
                          </div>
                          <div class="flex justify-between items-center">
                              <span class="text-sm text-gray-400">Total Tools</span>
                              <span class="text-lg font-semibold text-blue-400" id="mcp-total-tools">-</span>
                          </div>
                          <div class="flex justify-between items-center">
                              <span class="text-sm text-gray-400">Total Resources</span>
                              <span class="text-lg font-semibold text-purple-400" id="mcp-total-resources">-</span>
                          </div>
                      </div>
                  </div>

                  <!-- MCP Performance -->
                  <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                      <h3 class="text-lg font-semibold mb-4 flex items-center">
                          <i data-lucide="activity" class="w-5 h-5 mr-2"></i>Performance
                      </h3>
                      <div class="space-y-4">
                          <div class="flex justify-between items-center">
                              <span class="text-sm text-gray-400">Total Requests</span>
                              <span class="text-lg font-semibold text-cyan-400" id="mcp-total-requests">-</span>
                          </div>
                          <div class="flex justify-between items-center">
                              <span class="text-sm text-gray-400">Success Rate</span>
                              <span class="text-lg font-semibold text-green-400" id="mcp-success-rate">-</span>
                          </div>
                          <div class="flex justify-between items-center">
                              <span class="text-sm text-gray-400">Avg Response Time</span>
                              <span class="text-sm text-gray-300" id="mcp-avg-response">-</span>
                          </div>
                      </div>
                  </div>

                  <!-- MCP Security -->
                  <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                      <h3 class="text-lg font-semibold mb-4 flex items-center">
                          <i data-lucide="lock" class="w-5 h-5 mr-2"></i>Security Status
                      </h3>
                      <div class="space-y-4">
                          <div class="flex justify-between items-center">
                              <span class="text-sm text-gray-400">Auth Failures</span>
                              <span class="text-lg font-semibold text-red-400" id="mcp-auth-failures">-</span>
                          </div>
                          <div class="flex justify-between items-center">
                              <span class="text-sm text-gray-400">Rate Limited</span>
                              <span class="text-lg font-semibold text-yellow-400" id="mcp-rate-limited">-</span>
                          </div>
                          <div class="flex justify-between items-center">
                              <span class="text-sm text-gray-400">Active Tokens</span>
                              <span class="text-lg font-semibold text-blue-400" id="mcp-active-tokens">-</span>
                          </div>
                      </div>
                  </div>
              </div>

              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                  <!-- MCP Servers -->
                  <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                      <h3 class="text-lg font-semibold mb-4 flex items-center">
                          <i data-lucide="server" class="w-5 h-5 mr-2"></i>MCP Servers
                      </h3>
                      <div id="mcp-servers-list" class="space-y-3">
                          <!-- MCP servers will be populated by JavaScript -->
                          <div class="text-center text-gray-400 py-8">
                              <i data-lucide="server" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
                              <p>Loading MCP servers...</p>
                          </div>
                      </div>
                  </div>

                  <!-- MCP Tools & Resources -->
                  <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                      <h3 class="text-lg font-semibold mb-4 flex items-center">
                          <i data-lucide="wrench" class="w-5 h-5 mr-2"></i>Tools & Resources
                      </h3>
                      <div class="mb-4">
                          <div class="flex space-x-2 mb-3">
                              <button class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-sm" onclick="showMCPTools()">
                                  Tools
                              </button>
                              <button class="bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded text-sm" onclick="showMCPResources()">
                                  Resources
                              </button>
                          </div>
                          <div id="mcp-tools-resources" class="space-y-2 max-h-64 overflow-y-auto">
                              <!-- Tools and resources will be populated by JavaScript -->
                          </div>
                      </div>
                  </div>
              </div>

              <!-- Tool Execution -->
              <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                  <h3 class="text-lg font-semibold mb-4 flex items-center">
                      <i data-lucide="play" class="w-5 h-5 mr-2"></i>Tool Execution
                  </h3>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div>
                          <label class="block text-sm font-medium text-gray-300 mb-2">Server</label>
                          <select id="tool-server-select" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                              <option value="">Select Server</option>
                          </select>
                      </div>
                      <div>
                          <label class="block text-sm font-medium text-gray-300 mb-2">Tool</label>
                          <select id="tool-name-select" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                              <option value="">Select Tool</option>
                          </select>
                      </div>
                  </div>
                  <div class="mt-4">
                      <label class="block text-sm font-medium text-gray-300 mb-2">Arguments (JSON)</label>
                      <textarea id="tool-arguments" rows="3" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white font-mono text-sm" placeholder='{"key": "value"}'></textarea>
                  </div>
                  <div class="mt-4 flex space-x-2">
                      <button class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg text-sm font-medium" onclick="executeMCPTool()">
                          Execute Tool
                      </button>
                      <button class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg text-sm font-medium" onclick="clearToolForm()">
                          Clear
                      </button>
                  </div>
                  <div id="tool-result" class="mt-4 p-3 bg-gray-900 rounded-lg font-mono text-sm max-h-32 overflow-y-auto hidden">
                      <!-- Tool execution results will be shown here -->
                  </div>
              </div>
          </div>

          <!-- Community Vault Tab -->
          <div id="vault-tab" class="tab-content hidden">
              <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
                  <!-- Vault Stats -->
                  <div class="lg:col-span-1">
                      <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                          <h3 class="text-lg font-semibold mb-4 flex items-center">
                              <i data-lucide="bar-chart-3" class="w-5 h-5 mr-2"></i>Vault Stats
                          </h3>
                          <div class="space-y-3">
                              <div class="flex justify-between">
                                  <span class="text-sm text-gray-400">Total Items</span>
                                  <span class="text-lg font-semibold text-blue-400" id="vault-total-items">-</span>
                              </div>
                              <div class="flex justify-between">
                                  <span class="text-sm text-gray-400">Total Downloads</span>
                                  <span class="text-lg font-semibold text-green-400" id="vault-total-downloads">-</span>
                              </div>
                              <div class="flex justify-between">
                                  <span class="text-sm text-gray-400">Avg Rating</span>
                                  <span class="text-lg font-semibold text-yellow-400" id="vault-avg-rating">-</span>
                              </div>
                              <div class="flex justify-between">
                                  <span class="text-sm text-gray-400">Categories</span>
                                  <span class="text-lg font-semibold text-purple-400" id="vault-categories-count">-</span>
                              </div>
                          </div>
                      </div>
                  </div>

                  <!-- Vault Search and Filters -->
                  <div class="lg:col-span-3">
                      <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-6">
                          <h3 class="text-lg font-semibold mb-4 flex items-center">
                              <i data-lucide="search" class="w-5 h-5 mr-2"></i>Search & Filter
                          </h3>
                          <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                              <div>
                                  <input type="text" id="vault-search" placeholder="Search items..."
                                      class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-400">
                              </div>
                              <div>
                                  <select id="vault-category-filter" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                                      <option value="">All Categories</option>
                                  </select>
                              </div>
                              <div>
                                  <select id="vault-sort-by" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                                      <option value="downloads">Most Downloads</option>
                                      <option value="rating">Highest Rated</option>
                                      <option value="created_at">Newest</option>
                                      <option value="updated_at">Recently Updated</option>
                                  </select>
                              </div>
                              <div class="flex space-x-2">
                                  <button id="vault-search-btn" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                                      <i data-lucide="search" class="w-4 h-4"></i>
                                  </button>
                                  <button id="vault-publish-btn" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors">
                                      <i data-lucide="plus" class="w-4 h-4"></i>
                                  </button>
                              </div>
                          </div>
                      </div>

                      <!-- Vault Items Grid -->
                      <div id="vault-items-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                          <!-- Items will be populated by JavaScript -->
                          <div class="col-span-full text-center text-gray-400 py-12">
                              <i data-lucide="package" class="w-16 h-16 mx-auto mb-4 opacity-50"></i>
                              <p class="text-lg mb-2">Loading Community Vault...</p>
                              <p class="text-sm">Discover tools, configs, and agent evolutions</p>
                          </div>
                      </div>

                      <!-- Load More Button -->
                      <div class="text-center mt-6">
                          <button id="vault-load-more" class="bg-gray-700 hover:bg-gray-600 px-6 py-2 rounded-lg transition-colors hidden">
                              Load More Items
                          </button>
                      </div>
                  </div>
              </div>
          </div>

      </main>

    <!-- Footer -->
    <footer class="bg-gray-800 border-t border-gray-700 px-6 py-4 mt-12">
        <div class="flex items-center justify-between text-sm text-gray-400">
            <div>
                <p>&copy; 2024 ZEJZL.NET - AI Orchestration Framework</p>
            </div>
            <div class="flex items-center space-x-4">
                <span id="last-updated">Last updated: <span id="timestamp">-</span></span>
                <span>v2.0.0</span>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/static/js/api.js"></script>
    <script src="/static/js/websocket.js"></script>
    <script src="/static/js/ui.js"></script>
    <script src="/static/js/charts.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Security Tab Functionality
        let securityChart = null;

        // Tab switching
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabName = this.dataset.tab;

                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });

                // Remove active class from all tabs
                document.querySelectorAll('.nav-tab').forEach(t => {
                    t.classList.remove('active', 'bg-blue-600', 'text-white');
                    t.classList.add('bg-gray-700', 'hover:bg-gray-600');
                });

                // Show selected tab
                document.getElementById(tabName + '-tab').classList.remove('hidden');

                // Make clicked tab active
                this.classList.add('active', 'bg-blue-600', 'text-white');
                this.classList.remove('bg-gray-700', 'hover:bg-gray-600');

                // Load tab-specific data
                if (tabName === 'security') {
                    loadSecurityData();
                }
            });
        });

        // Security Functions
        async function loadSecurityData() {
            try {
                const response = await fetch('/api/security/overview');
                const data = await response.json();

                if (data.success) {
                    updateSecurityOverview(data.data);
                    updatePendingApprovals(data.data.pending_approvals);
                    updateRiskChart(data.data.report.risk_distribution || {});
                }
            } catch (error) {
                console.error('Failed to load security data:', error);
            }
        }

        function updateSecurityOverview(data) {
            document.getElementById('total-validations').textContent = data.total_validations || 0;
            document.getElementById('pending-approvals').textContent = data.pending_count || 0;
            document.getElementById('blocked-operations').textContent = data.blocked_count || 0;
        }

        function updatePendingApprovals(approvals) {
            const container = document.getElementById('pending-approvals-list');

            if (!approvals || approvals.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-400 py-8">
                        <i data-lucide="check-circle" class="w-12 h-12 mx-auto mb-4 opacity-50"></i>
                        <p>No pending approvals</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = approvals.map(approval => `
                <div class="bg-gray-700 rounded-lg p-4 border border-gray-600">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <h4 class="font-semibold text-white mb-1">${approval.operation || 'Unknown Operation'}</h4>
                            <p class="text-sm text-gray-400">Risk: ${approval.validation?.risk_level || 'unknown'}</p>
                            <p class="text-sm text-gray-400">User: ${approval.user_id || 'unknown'}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="approveOperation('${approval.approval_id}', true)"
                                    class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                Approve
                            </button>
                            <button onclick="approveOperation('${approval.approval_id}', false)"
                                    class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors">
                                Deny
                            </button>
                        </div>
                    </div>
                    ${approval.validation?.violations?.length > 0 ? `
                        <div class="bg-red-900 border border-red-700 rounded p-3">
                            <h5 class="text-red-400 font-semibold mb-2">Violations:</h5>
                            <ul class="text-red-300 text-sm space-y-1">
                                ${approval.validation.violations.map(v => `<li>â€¢ ${v}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
            `).join('');

            // Re-initialize icons for new content
            lucide.createIcons();
        }

        function updateRiskChart(riskData) {
            const ctx = document.getElementById('risk-chart').getContext('2d');

            if (securityChart) {
                securityChart.destroy();
            }

            const labels = Object.keys(riskData);
            const values = Object.values(riskData);

            securityChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: [
                            '#10B981', // safe - green
                            '#3B82F6', // low_risk - blue
                            '#F59E0B', // medium_risk - yellow
                            '#EF4444', // high_risk - red
                            '#7C2D12'  // critical - dark red
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#9CA3AF'
                            }
                        }
                    }
                }
            });
        }

        async function approveOperation(approvalId, approved) {
            try {
                const response = await fetch('/api/security/approve', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        approval_id: approvalId,
                        approved: approved,
                        admin_user: 'web_admin'
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // Refresh the security data
                    loadSecurityData();
                    // Show success message
                    showNotification(`Operation ${approved ? 'approved' : 'denied'} successfully`, 'success');
                } else {
                    showNotification(`Failed to ${approved ? 'approve' : 'deny'} operation: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Approval error:', error);
                showNotification('Failed to process approval', 'error');
            }
        }

        async function validateOperation() {
            const operation = prompt('Enter operation to validate:');
            if (!operation) return;

            try {
                const response = await fetch('/api/security/validate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        operation: operation,
                        user: 'web_user'
                    })
                });

                const result = await response.json();

                if (result.success) {
                    const data = result.data;
                    let message = `Risk Level: ${data.risk_level}\nApproval Required: ${data.approval_required}\nCan Proceed: ${data.can_proceed}`;

                    if (data.violations.length > 0) {
                        message += `\n\nViolations:\n${data.violations.join('\n')}`;
                    }

                    if (data.recommendations.length > 0) {
                        message += `\n\nRecommendations:\n${data.recommendations.join('\n')}`;
                    }

                    alert(message);
                } else {
                    alert(`Validation failed: ${result.error}`);
                }
            } catch (error) {
                console.error('Validation error:', error);
                alert('Failed to validate operation');
            }
        }

        function refreshSecurityData() {
            loadSecurityData();
            showNotification('Security data refreshed', 'success');
        }

        function exportSecurityReport() {
            // This would trigger a download of the security report
            showNotification('Security report export not yet implemented', 'info');
        }

        function configureSecurityPolicies() {
            // This would open a policy configuration dialog
            showNotification('Security policy configuration not yet implemented', 'info');
        }

        function showNotification(message, type = 'info') {
            // Simple notification - you could enhance this with a proper notification system
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600',
                info: 'bg-blue-600'
            };

            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-4 py-2 rounded-lg shadow-lg z-50`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        // Add validate operation button to security actions
        document.addEventListener('DOMContentLoaded', function() {
            const actionsDiv = document.querySelector('#security-tab .space-y-3');
            if (actionsDiv) {
                const validateButton = document.createElement('button');
                validateButton.className = 'w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors';
                validateButton.innerHTML = '<i data-lucide="search" class="w-4 h-4 inline mr-2"></i>Test Validation';
                validateButton.onclick = validateOperation;
                actionsDiv.appendChild(validateButton);
            }
        });
    </script>
</body>
</html>